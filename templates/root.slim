#root-content

  #audios

  #audio-template.hidden
    .audio-template-content.box
      button.remove X
      br
      button.play play
      button.stop.hidden stop
      .dropdowns
        select name='oscillator-type'
          option value='sine' sine
          option value='sawtooth' sawtooth
          option value='triangle' triangle
          option value='square' square

      .sliders
        input name='oscillator' value='200' type='range' step='any' min='1' max='500'
        label for='oscillator' oscillator
        br
        input name='gain' type='range' min='0.01' max='5' step='any' value='1'
        label for='gain' gain

  button#add-audio onclick='Events.add_audio()' add audio
  br
  
  #analyser.box
    .analyser-metric.box
      i note
      #note
    .analyser-metric.box
      i semitones
      #semitones
    .analyser-metric.box
      i hz
      #hz

    

coffee:

  $ ->

    window.Dom = (->
      @audios = $("#audios")
      @audio_template = $("#audio-template")
      @analyser = $("#analyser")
      @analyser_note = @analyser.find("#note")
      @analyser_hz = @analyser.find("#hz")
      @analyser_semitones = @analyser.find("#semitones")
      this
    ).apply {}

    Utils.init_analyser ({note, hz, semitones}) ->
      Dom.analyser_note.text(note)
      Dom.analyser_hz.text(hz) unless isNaN hz
      Dom.analyser_semitones.text(semitones) unless isNaN semitones


    window.Events =
      add_audio: (e) -> (->

        $template = $ Dom.audio_template[0].innerHTML
        Dom.audios.append $template
        $play_btn = $template.find(".play")
        $stop_btn = $template.find(".stop")
        $remove_btn = $template.find(".remove")
        sliders = 
          $oscillator: $template.find(".sliders [name='oscillator']")
          $gain: $template.find(".sliders [name='gain']")
        dropdowns =
          $oscillator_type: $template.find(".dropdowns [name='oscillator-type']")

        id = (@last_id += 1)

        $play_btn.on "click", =>
          @create_nodes(id)
          $play_btn.addClass("hidden")
          $stop_btn.removeClass("hidden")

        $stop_btn.on "click", =>
          @stop_nodes(id)
          $play_btn.removeClass("hidden")
          $stop_btn.addClass("hidden")

        $remove_btn.on "click", =>
          @stop_nodes(id)
          $template.remove()

        sliders.$oscillator.on "input", =>
          freq = parseFloat sliders.$oscillator.val()
          @nodes[id].oscillator.frequency.value = freq

        sliders.$gain.on "input", =>
          val = parseFloat sliders.$gain.val()
          @nodes[id].gain.gain.value = val

        dropdowns.$oscillator_type.on "change", =>
          type = dropdowns.$oscillator_type.val()
          @nodes[id].oscillator.type = type

          

      ).apply Utils




