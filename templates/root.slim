#root-content

  button#add-tone-generator add tone generator
  #tone-generators

  #tone-generator-html.hidden
    .bordered
      button.start start tone generator
      button.stop.hidden stop tone generator
      br

      input.freq type='range' min='0' max='500'
      button.remove X
  
coffee:

  # --------------------------------------------------
  # Tone generator
  # --------------------------------------------------
  (->

    # HTML for a tone generator row
    tone_generator_html = $root_content.find("#tone-generator-html")[0].innerHTML

    # Button to add a tone generator row
    $add_tone_generator = $root_content.find("#add-tone-generator")
    $tone_generators = $root_content.find("#tone-generators")

    # Each row has handlers invoked in its own context (via the IEFE)
    $add_tone_generator.on "click", (e) -> (->

      # Add the HTML to DOM
      @$row = $ tone_generator_html
      $tone_generators.append @$row

      # Find controls of row
      $start_btn = @$row.find(".start")
      $stop_btn = @$row.find(".stop")
      $freq_slider = @$row.find(".freq")
      $remove_btn = @$row.find(".remove")

      # Start button for row
      $start_btn.on 'click', (e) =>
        $start_btn.addClass "hidden"
        $stop_btn.removeClass "hidden"
        @tone_generator = new ToneGenerator()
        @tone_generator.playing = false
        @tone_generator.update type: "sine", freq: 200
        @tone_generator.start()
        @tone_generator.playing = true

      # Stop button for row
      $stop_btn.on 'click', (e) =>
        $stop_btn.addClass "hidden"
        $start_btn.removeClass "hidden"      
        @tone_generator.stop()
        @tone_generator.close()
        @tone_generator.playing = false

      # Frequency slider for row
      $freq_slider.on 'input', (e) =>
        freq = ~~$freq_slider.val()
        @tone_generator.update { type: "sine", freq }

      # Remove button for row
      $remove_btn.on 'click', (e) =>
        @tone_generator.stop() if @tone_generator.playing
        @tone_generator.close()
        @$row.remove()
    ).apply {}
  )()
    